<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>TIL how to add dependencies with Ansible and Semaphore - Tild</title><meta name="description" content="For a work project, I had to use pupeeter to generate pdf file from a web page. On local, installing puppeteer was simple, foloowing the installation guide and installing the correct chromium version. But when the new feature arrived on the development server, the chromium did&hellip;"><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://wagam.github.io/tild/til-how-to-add-dependencies-with-ansible-and-semaphore.html"><link rel="amphtml" href="https://wagam.github.io/tild/amp/til-how-to-add-dependencies-with-ansible-and-semaphore.html"><link rel="alternate" type="application/atom+xml" href="https://wagam.github.io/tild/feed.xml"><link rel="alternate" type="application/json" href="https://wagam.github.io/tild/feed.json"><meta property="og:title" content="TIL how to add dependencies with Ansible and Semaphore"><meta property="og:image" content="https://wagam.github.io/tild/media/posts/22/chevrolet-4254343_1280.jpg"><meta property="og:site_name" content="Tild"><meta property="og:description" content="For a work project, I had to use pupeeter to generate pdf file from a web page. On local, installing puppeteer was simple, foloowing the installation guide and installing the correct chromium version. But when the new feature arrived on the development server, the chromium did&hellip;"><meta property="og:url" content="https://wagam.github.io/tild/til-how-to-add-dependencies-with-ansible-and-semaphore.html"><meta property="og:type" content="article"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Josefin+Sans&family=Josefin+Slab:wght@700&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://wagam.github.io/tild/assets/css/style.css?v=0200466040e50c410ff8e08f29f3aa58"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://wagam.github.io/tild/til-how-to-add-dependencies-with-ansible-and-semaphore.html"},"headline":"TIL how to add dependencies with Ansible and Semaphore","datePublished":"2020-05-28T09:08","dateModified":"2020-05-28T09:08","image":{"@type":"ImageObject","url":"https://wagam.github.io/tild/media/posts/22/chevrolet-4254343_1280.jpg","height":761,"width":1280},"description":"For a work project, I had to use pupeeter to generate pdf file from a web page. On local, installing puppeteer was simple, foloowing the installation guide and installing the correct chromium version. But when the new feature arrived on the development server, the chromium did&hellip;","author":{"@type":"Person","name":"Marc"},"publisher":{"@type":"Organization","name":"Marc"}}</script><script async src="https://wagam.github.io/tild/assets/js/lazysizes.min.js?v=300b16f1c14e1537e6b064f464ab33b1"></script></head><body><header class="topbar js-top is-sticky"><div class="topbar__inner"><a class="logo" href="https://wagam.github.io/tild/">Tild</a><nav class="navbar js-navbar"><button class="navbar__toggle js-navbar__toggle">Menu</button><ul class="navbar__menu"></ul></nav></div></header><div class="content"><div class="infobar"><div class="infobar__search"><form action="https://wagam.github.io/tild/search.html"><input type="search" name="q" placeholder=" search..."></form></div></div><main class="main main--full"><article class="post"><figure class="post__featured-image" style="padding-bottom: calc(761/1280 * 100%)"><img class="lazyload" src="https://wagam.github.io/tild/media/posts/22/responsive/chevrolet-4254343_1280-xs.jpg" data-srcset="https://wagam.github.io/tild/media/posts/22/responsive/chevrolet-4254343_1280-xs.jpg 300w ,https://wagam.github.io/tild/media/posts/22/responsive/chevrolet-4254343_1280-sm.jpg 480w ,https://wagam.github.io/tild/media/posts/22/responsive/chevrolet-4254343_1280-md.jpg 768w ,https://wagam.github.io/tild/media/posts/22/responsive/chevrolet-4254343_1280-lg.jpg 1024w ,https://wagam.github.io/tild/media/posts/22/responsive/chevrolet-4254343_1280-xl.jpg 1360w ,https://wagam.github.io/tild/media/posts/22/responsive/chevrolet-4254343_1280-2xl.jpg 1600w" data-sizes="auto" alt=""><figcaption>Chromium Chevelle Image by Berat Hacioglu from Pixabay</figcaption></figure><header class="u-header post__header"><h1>TIL how to add dependencies with Ansible and Semaphore</h1><div class="u-header__meta u-small"><div><a href="https://wagam.github.io/tild/authors/marc/" title="Marc">Marc</a> <time datetime="2020-05-28T09:08">28 mai 2020</time></div></div></header><div class="post__entry u-inner"><p>For a work project, I had to use pupeeter to generate pdf file from a web page. </p><p>On local, installing puppeteer was simple, foloowing the installation guide and installing the correct chromium version. </p><p>But when the new feature arrived on the development server, the chromium did not started because of this message: </p><figure class="post__image"><img class="lazyload" src="https://wagam.github.io/tild/media/posts/22/responsive/Capture-decran-2020-05-27-a-16.18.47-xs.png" data-sizes="auto" data-srcset="https://wagam.github.io/tild/media/posts/22/responsive/Capture-decran-2020-05-27-a-16.18.47-xs.png 300w ,https://wagam.github.io/tild/media/posts/22/responsive/Capture-decran-2020-05-27-a-16.18.47-sm.png 480w ,https://wagam.github.io/tild/media/posts/22/responsive/Capture-decran-2020-05-27-a-16.18.47-md.png 768w ,https://wagam.github.io/tild/media/posts/22/responsive/Capture-decran-2020-05-27-a-16.18.47-lg.png 1024w ,https://wagam.github.io/tild/media/posts/22/responsive/Capture-decran-2020-05-27-a-16.18.47-xl.png 1360w ,https://wagam.github.io/tild/media/posts/22/responsive/Capture-decran-2020-05-27-a-16.18.47-2xl.png 1600w" alt="" width="2451" height="934"></figure><p class="post__lead msg msg--highlight">Error while loading libXComposite.so</p><p>A good start point is the following line : </p><p class="msg--highlight msg">TROUBLESHOOTING: <a href="https://github.com/puppeteer/puppeteer/blob/master/docs/troubleshooting.md">https://github.com/puppeteer/puppeteer/blob/master/docs/troubleshooting.md</a></p><p>By following the link, I concluded I need to install missing deps like <code>libXComposite.so</code></p><p>I use Semaphore for the CI with Ansible and AWS. </p><p>I did not know what was the OS installed on AWS so I supposed it was a ubuntu or a debian one. So I tried to add this dependencies following this guide:  <a target="_blank" class="c-link" delay="150" data-sk="tooltip_parent" aria-describedby="sk-tooltip-ccfbf4a6-74ed-4a4d-98ab-b815773f48b9" href="https://semaphoreci.com/community/tutorials/introduction-to-ansible" rel="noopener noreferrer">https://semaphoreci.com/community/tutorials/introduction-to-ansible</a></p><p> The interesting part was here :</p><pre>- <span class="pl-ent">name</span>: <span class="pl-s">Install nginx</span>
      <span class="pl-ent">apt</span>:
        <span class="pl-c"># This package should be installed</span>
        <span class="pl-ent">state</span>: <span class="pl-s">present</span>
        <span class="pl-ent">name</span>: <span class="pl-s">nginx</span>
        <span class="pl-c"># 5 hours in seconds</span>
        <span class="pl-ent">cache_valid_time</span>: <span class="pl-c1">18000</span>
      <span class="pl-ent">become</span>: <span class="pl-c1">true</span>
<span class="pl-s"><span class="pl-pds"><br></span></span></pre><p>I decided to follow this part and I copy/pasted this code and replaced nginx (line 10)  by libXComposite. </p><p>But it was not correct. Ansible displayed an error with this message: </p><table id="log-table" class="c-job-code-block c-job-wrap-lines"><tbody><tr class="c-job-output" data-command-number="e7f0059f-7d94-4c0a-8b2e-c0401da34630"><td class="output"><span class="green">amazon-ebs: [WARNING]: Updating cache and auto-installing missing dependency: python-apt</span></td></tr></tbody></table><p>I thought I needed to install python-apt too. So I added python-apt </p><pre>- <span class="pl-ent">name</span>: <span class="pl-s">Install missing chromium deps</span>
      <span class="pl-ent">apt</span>:
        <span class="pl-c"># This package should be installed</span>
        <span class="pl-ent">state</span>: <span class="pl-s">present</span>
        <span class="pl-ent">name</span>: [python-apt, libxcomposite<span class="pl-s">]</span>
        <span class="pl-c"># 5 hours in seconds</span>
        <span class="pl-ent">cache_valid_time</span>: <span class="pl-c1">18000</span>
      <span class="pl-ent">become</span>: <span class="pl-c1">true</span>
<span class="pl-s"><span class="pl-pds"><br></span></span></pre><p>I still has errors: </p><p class="msg--highlight msg"><span class="green">fatal: [default]: FAILED! =&gt; {"changed": false, "msg": "Unsupported parameters for (apt) module: become Supported parameters include: allow_unauthenticated, autoclean, autoremove, cache_valid_time, deb, default_release, dpkg_options, force, force_apt_get, install_recommends, only_upgrade, package, policy_rc_d, purge, state, update_cache, upgrade"}</span></p><p>As I said earlier, I supposed I was running on a Ubuntu or debian machine. But it wasn't. It was a CentOS one. So I just change few lines of code : </p><div><pre><code>- name: install chromium deps for puppeteer</code><br><code> yum:</code><br><code>  name:</code><br><code>  - libXcomposite.x86_64</code><br><code> state: present</code></pre>And it works! </div><div> </div><div>What I learned this day is finally simple. Please be sure on which OS you work before doing anything. </div><div> </div><div>Enjoy!</div><div> </div></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on 28 mai 2020</div><div class="post__share"></div></aside><footer class="post__footer"><div class="post__bio u-author box"><div><h4 class="u-author__name"><a href="https://wagam.github.io/tild/authors/marc/" title="Marc">Marc</a></h4></div></div><nav class="post__nav box"><div class="post__nav__prev"><a href="https://wagam.github.io/tild/til-how-to-make-my-own-codepen-like.html" class="post__nav__link" rel="prev"><img class="lazyload" src="https://wagam.github.io/tild/media/posts/21/responsive/dual-screen-1745705_1280-xs.png" data-srcset="https://wagam.github.io/tild/media/posts/21/responsive/dual-screen-1745705_1280-xs.png" data-expand="300" alt=""><div class="u-small">Previous Post<h5>TIL how to make my own codepen like</h5></div></a></div></nav><div class="post__related box"><h3 class="box__title">Related posts</h3><div class="post__related__wrap"><figure><a href="https://wagam.github.io/tild/til-auto-fit-multiple-column-with-css-grid.html"><img class="lazyload" src="https://wagam.github.io/tild/media/posts/19/responsive/green-1738220_1280-xs.jpg" data-srcset="https://wagam.github.io/tild/media/posts/19/responsive/green-1738220_1280-xs.jpg 300w ,https://wagam.github.io/tild/media/posts/19/responsive/green-1738220_1280-sm.jpg 480w ,https://wagam.github.io/tild/media/posts/19/responsive/green-1738220_1280-md.jpg 768w ,https://wagam.github.io/tild/media/posts/19/responsive/green-1738220_1280-lg.jpg 1024w ,https://wagam.github.io/tild/media/posts/19/responsive/green-1738220_1280-xl.jpg 1360w ,https://wagam.github.io/tild/media/posts/19/responsive/green-1738220_1280-2xl.jpg 1600w" data-sizes="auto" data-expand="300" alt=""></a><figcaption><h4><a href="https://wagam.github.io/tild/til-auto-fit-multiple-column-with-css-grid.html" class="inverse">TIL auto fit multiple column with CSS grid</a></h4><time datetime="2020-04-28T08:00" class="u-small">28 avril 2020</time></figcaption></figure><figure><a href="https://wagam.github.io/tild/til-how-to-change-url-without-updating-page-in-browser.html"><img class="lazyload" src="https://wagam.github.io/tild/media/posts/17/responsive/white-ceramic-teacup-with-saucer-near-two-books-above-gray-904616-xs.jpg" data-srcset="https://wagam.github.io/tild/media/posts/17/responsive/white-ceramic-teacup-with-saucer-near-two-books-above-gray-904616-xs.jpg 300w ,https://wagam.github.io/tild/media/posts/17/responsive/white-ceramic-teacup-with-saucer-near-two-books-above-gray-904616-sm.jpg 480w ,https://wagam.github.io/tild/media/posts/17/responsive/white-ceramic-teacup-with-saucer-near-two-books-above-gray-904616-md.jpg 768w ,https://wagam.github.io/tild/media/posts/17/responsive/white-ceramic-teacup-with-saucer-near-two-books-above-gray-904616-lg.jpg 1024w ,https://wagam.github.io/tild/media/posts/17/responsive/white-ceramic-teacup-with-saucer-near-two-books-above-gray-904616-xl.jpg 1360w ,https://wagam.github.io/tild/media/posts/17/responsive/white-ceramic-teacup-with-saucer-near-two-books-above-gray-904616-2xl.jpg 1600w" data-sizes="auto" data-expand="300" alt=""></a><figcaption><h4><a href="https://wagam.github.io/tild/til-how-to-change-url-without-updating-page-in-browser.html" class="inverse">TIL how to change url without updating page in browser</a></h4><time datetime="2020-04-22T10:03" class="u-small">22 avril 2020</time></figcaption></figure><figure><a href="https://wagam.github.io/tild/til-how-to-rename-mass-files-with-zsh.html"><img class="lazyload" src="https://wagam.github.io/tild/media/posts/16/responsive/files-1614223_1280-xs.jpg" data-srcset="https://wagam.github.io/tild/media/posts/16/responsive/files-1614223_1280-xs.jpg 300w ,https://wagam.github.io/tild/media/posts/16/responsive/files-1614223_1280-sm.jpg 480w ,https://wagam.github.io/tild/media/posts/16/responsive/files-1614223_1280-md.jpg 768w ,https://wagam.github.io/tild/media/posts/16/responsive/files-1614223_1280-lg.jpg 1024w ,https://wagam.github.io/tild/media/posts/16/responsive/files-1614223_1280-xl.jpg 1360w ,https://wagam.github.io/tild/media/posts/16/responsive/files-1614223_1280-2xl.jpg 1600w" data-sizes="auto" data-expand="300" alt=""></a><figcaption><h4><a href="https://wagam.github.io/tild/til-how-to-rename-mass-files-with-zsh.html" class="inverse">TIL how to rename mass files with zsh</a></h4><time datetime="2020-04-18T15:48" class="u-small">18 avril 2020</time></figcaption></figure></div></div></footer></article></main><footer class="footer"><a class="footer__logo" href="https://wagam.github.io/tild/">Tild</a><nav><ul class="footer__nav"></ul></nav><div class="footer__copyright">Marc © 2020</div></footer></div><script defer="defer" src="https://wagam.github.io/tild/assets/js/jquery-3.2.1.slim.min.js?v=5f48fc77cac90c4778fa24ec9c57f37d"></script><script defer="defer" src="https://wagam.github.io/tild/assets/js/scripts.min.js?v=07b53ae91f8045eab042a695e4a26034"></script></body></html>